From bd9b248803220690d72db45e06d677918cb1b454 Mon Sep 17 00:00:00 2001
From: ruslanbay <67730802+ruslanbay@users.noreply.github.com>
Date: Fri, 16 Jan 2026 14:29:28 +0100
Subject: [PATCH 39/39] ipu_buttress_authenticate: try again if failed

---
 drivers/media/pci/intel/ipu-isys-video.c | 16 +++++++++++++++-
 1 file changed, 15 insertions(+), 1 deletion(-)

diff --git a/drivers/media/pci/intel/ipu-isys-video.c b/drivers/media/pci/intel/ipu-isys-video.c
index 3ccb4a0f9..946eb566f 100644
--- a/drivers/media/pci/intel/ipu-isys-video.c
+++ b/drivers/media/pci/intel/ipu-isys-video.c
@@ -230,6 +230,7 @@ static int video_open(struct file *file)
 	struct ipu_bus_device *adev = to_ipu_bus_device(&isys->adev->dev);
 	struct ipu_device *isp = adev->isp;
 	int rval;
+    int retries = 3; 
 
 	mutex_lock(&isys->mutex);
 
@@ -240,7 +241,20 @@ static int video_open(struct file *file)
 	}
 	mutex_unlock(&isys->mutex);
 
-	rval = ipu_buttress_authenticate(isp);
+	do {
+		rval = ipu_buttress_authenticate(isp);
+		if (rval == 0)
+			break;
+
+		dev_warn(&isys->adev->dev, 
+				 "FW authentication failed, retrying... (%d attempts left)\n", 
+				 retries);
+		
+		/* delay between retries to allow hardware to settle */
+		usleep_range(1000, 2000); 
+		
+	} while (retries-- > 0);
+
 	if (rval) {
 		dev_err(&isys->adev->dev, "FW authentication failed\n");
 		return rval;
-- 
2.48.1

