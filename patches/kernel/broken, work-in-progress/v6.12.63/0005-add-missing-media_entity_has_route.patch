From 3a0b1238262d59596a04277ccffd073b5af7ebd0 Mon Sep 17 00:00:00 2001
From: ruslanbay <67730802+ruslanbay@users.noreply.github.com>
Date: Sun, 21 Dec 2025 17:39:53 +0100
Subject: [PATCH 05/29] add missing media_entity_has_route

---
 drivers/media/mc/mc-entity.c | 29 +++++++++++++++++++++++++++++
 include/media/media-entity.h |  8 ++++++++
 2 files changed, 37 insertions(+)

diff --git a/drivers/media/mc/mc-entity.c b/drivers/media/mc/mc-entity.c
index b3761839a521..fffdf0194f4d 100644
--- a/drivers/media/mc/mc-entity.c
+++ b/drivers/media/mc/mc-entity.c
@@ -288,6 +288,35 @@ media_entity_other(struct media_entity *entity, struct media_link *link)
 		return link->source->entity;
 }
 
+/**
+ * media_entity_has_route - Check if two entity pads are connected internally
+ * @entity: The entity
+ * @pad0: The first pad index
+ * @pad1: The second pad index
+ *
+ * This function can be used to check whether two pads of an entity are
+ * connected internally in the entity.
+ *
+ * The caller must hold entity->source->parent->mutex.
+ *
+ * Return: true if the pads are connected internally and false otherwise.
+ */
+bool media_entity_has_route(struct media_entity *entity, unsigned int pad0,
+			    unsigned int pad1)
+{
+	if (pad0 >= entity->num_pads || pad1 >= entity->num_pads)
+		return false;
+
+	if (pad0 == pad1)
+		return true;
+
+	if (!entity->ops || !entity->ops->has_route)
+		return true;
+
+	return entity->ops->has_route(entity, pad0, pad1, NULL);
+}
+EXPORT_SYMBOL_GPL(media_entity_has_route);
+
 /* push an entity to traversal stack */
 static void stack_push(struct media_graph *graph,
 		       struct media_entity *entity)
diff --git a/include/media/media-entity.h b/include/media/media-entity.h
index 0393b23129eb..84e55d7c879b 100644
--- a/include/media/media-entity.h
+++ b/include/media/media-entity.h
@@ -269,6 +269,9 @@ struct media_pad {
  *			media_entity_has_pad_interdep().
  *			Optional: If the operation isn't implemented all pads
  *			will be considered as interdependent.
+ * @has_route:		Return whether a route exists inside the entity between
+ *			two given pads. Optional. If the operation isn't
+ *			implemented all pads will be considered as connected.
  *
  * .. note::
  *
@@ -284,6 +287,8 @@ struct media_entity_operations {
 	int (*link_validate)(struct media_link *link);
 	bool (*has_pad_interdep)(struct media_entity *entity, unsigned int pad0,
 				 unsigned int pad1);
+	bool (*has_route)(struct media_entity *entity, unsigned int pad0,
+			  unsigned int pad1, int *stream);
 };
 
 /**
@@ -513,6 +518,9 @@ __must_check int media_entity_enum_init(struct media_entity_enum *ent_enum,
  */
 void media_entity_enum_cleanup(struct media_entity_enum *ent_enum);
 
+bool media_entity_has_route(struct media_entity *entity, unsigned int sink,
+			unsigned int source);
+
 /**
  * media_entity_enum_zero - Clear the entire enum
  *
-- 
2.51.0

