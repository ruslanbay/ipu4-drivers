From a2d0f79d16c27226e989ca3ba5ee2878b756fd8a Mon Sep 17 00:00:00 2001
From: Ruslan Bay <67730802+ruslanbay@users.noreply.github.com>
Date: Tue, 17 Feb 2026 06:32:44 +0000
Subject: [PATCH 42/54] media: intel/ipu4: Add guards for uninitialized array
 cleanup

Add NULL checks before cleaning up arrays that may not have been allocated.
This prevents potential crashes when the isys_unregister_subdevices() cleanup
path runs on devices where initialization failed or was incomplete.

---
 drivers/media/pci/intel/ipu-isys.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/drivers/media/pci/intel/ipu-isys.c b/drivers/media/pci/intel/ipu-isys.c
index 75085e5d475f..d4c1ea5d613e 100644
--- a/drivers/media/pci/intel/ipu-isys.c
+++ b/drivers/media/pci/intel/ipu-isys.c
@@ -215,11 +215,13 @@ static void isys_unregister_subdevices(struct ipu_isys *isys)
 
 	ipu_isys_isa_cleanup(&isys->isa);
 
-	for (i = 0; i < tpg->ntpgs; i++)
-		ipu_isys_tpg_cleanup(&isys->tpg[i]);
+	if (isys->tpg)
+		for (i = 0; i < tpg->ntpgs; i++)
+			ipu_isys_tpg_cleanup(&isys->tpg[i]);
 
-	for (i = 0; i < csi2->nports; i++)
-		ipu_isys_csi2_cleanup(&isys->csi2[i]);
+	if (isys->csi2)
+		for (i = 0; i < csi2->nports; i++)
+			ipu_isys_csi2_cleanup(&isys->csi2[i]);
 }
 
 static int isys_register_subdevices(struct ipu_isys *isys)
-- 
2.51.0

